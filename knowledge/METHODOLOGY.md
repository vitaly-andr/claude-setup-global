# Методика Memory Bank

Система накопления и использования проверенных знаний для агентов Claude Code.

## Философия

**Цель**: Минимизировать повторные обращения к внешним источникам за информацией, которую мы уже успешно применяли.

**Принцип**: Каждое успешное решение → новое знание в базе

**Качество**: Только проверенные, протестированные решения

## Рабочий процесс

### 1. Решение задачи (sysadmin)

При получении задачи sysadmin агент:

1. **Проверяет локальную базу знаний** (`~/.claude/knowledge/sysadmin/`)
   - Читает релевантные файлы из категорий
   - Ищет похожие решенные проблемы
   - Использует существующие команды как первый источник

2. **Если решения нет локально** → использует WebSearch/WebFetch
   - Ищет в официальной документации
   - Проверяет Arch Wiki, GitHub issues, официальные форумы

3. **Применяет решение** и тестирует

4. **Если решение успешно** → переходит к этапу сохранения

### 2. Валидация решения (librarian)

После успешного решения sysadmin вызывает librarian для проверки:

```
"Прошу librarian проверить корректность примененного решения
и подтвердить его для сохранения в memory bank"
```

Librarian проверяет:
- ✅ Решение корректно по документации
- ✅ Использованы актуальные версии и команды
- ✅ Нет deprecated методов или уязвимостей
- ✅ Решение переиспользуемо для похожих ситуаций

### 3. Сохранение в Memory Bank

**Формат файла решения**:
```markdown
# [Четкое описание проблемы]

> Дата: YYYY-MM-DD
> Валидировано: librarian
> Система: [версия ОС/ПО]
> Теги: #tag1 #tag2 #tag3

## Контекст
Краткое описание ситуации, когда применимо

## Решение
\`\`\`bash
# Конкретные команды с комментариями
\`\`\`

## Объяснение
Почему это работает, важные детали

## Альтернативы
Другие подходы, если применимо

## Источники
- [Документация](url)
- [Проверено](url)
```

**Куда сохранять**:

1. **Краткосрочное** → `solutions/YYYY-MM-DD-описание.md` (всегда)

2. **Долгосрочное** → соответствующая категория:
   - `arch-linux/` - команды pacman, системные настройки
   - `hyprland/` - конфигурации Hyprland
   - `waybar/` - конфигурации Waybar
   - `common-issues/` - частые проблемы и их решения

### 4. Обновление базы знаний

**Когда обновлять категории**:
- При накоплении 3+ похожих решений → обобщить в категорию
- При обнаружении устаревшего решения → обновить с пометкой даты
- При нахождении более эффективного метода → добавить секцию "Обновления"

**Workflow обновления**:

```
sysadmin: "Обнаружил, что решение X устарело, нашел новое Y"
↓
librarian: "Подтверждаю, решение Y актуально для версии Z"
↓
sysadmin: "Обновляю файл в knowledge base с пометкой устаревания X"
```

## Шаблоны

### Новая команда/решение

```markdown
### [Название]
\`\`\`bash
команда
\`\`\`
**Когда использовать**: описание
**Версия**: X.Y.Z+
**Проверено**: YYYY-MM-DD
```

### Частая проблема

```markdown
# [Проблема]

**Симптомы**: что видим
**Причина**: почему происходит
**Решение**:
\`\`\`bash
команды
\`\`\`
**Проверено**: YYYY-MM-DD на [система версия]
```

## Метрики эффективности

Отслеживаем (неформально):
- Сколько раз использовали локальное решение vs новый поиск
- Сколько решений добавлено в базу
- Сколько раз обновляли устаревшие решения

**Цель**: Через месяц использования >70% задач решаются из локальной базы

## Правила использования

### Для sysadmin

1. **ВСЕГДА** сначала проверяй `~/.claude/knowledge/sysadmin/`
2. **ПРЕДЛАГАЙ** сохранение после каждого нетривиального успешного решения
3. **ОБРАЩАЙСЯ** к librarian для валидации перед сохранением
4. **ОБНОВЛЯЙ** базу при обнаружении устаревших методов

### Для librarian

1. **ПРОВЕРЯЙ** решения на актуальность и корректность
2. **ОТМЕЧАЙ** источники и даты валидации
3. **ПРЕДУПРЕЖДАЙ** об устаревших методах
4. **МОЖЕТ РЕДАКТИРОВАТЬ** только documentation файлы в knowledge/

### Для пользователя

1. Периодически просматривай `solutions/` для выявления паттернов
2. Помогай объединять похожие решения в категории
3. Удаляй устаревшие решения, которые больше не работают

## Примеры использования

### Пример 1: Новая задача

```
Пользователь: "Настрой multi-monitor setup для Hyprland"
↓
sysadmin:
  1. Читает ~/.claude/knowledge/sysadmin/hyprland/monitors.md
  2. Находит похожую конфигурацию
  3. Применяет с адаптацией
  4. Тестирует
  5. Работает? → Предлагает обновить файл с новым вариантом
```

### Пример 2: Проблема

```
Пользователь: "Waybar не показывает battery widget"
↓
sysadmin:
  1. Читает ~/.claude/knowledge/sysadmin/common-issues/waybar-*.md
  2. Не находит похожего
  3. WebSearch → находит решение
  4. Применяет → работает!
  5. Вызывает librarian для проверки
  6. Сохраняет в solutions/ и common-issues/waybar-battery-widget.md
```

### Пример 3: Устаревшее решение

```
sysadmin пытается применить решение из knowledge/
↓
Решение не работает (пакет переименован/удален)
↓
WebSearch → находит новое решение
↓
librarian проверяет
↓
sysadmin обновляет файл в knowledge/:
  - Помечает старое решение как "⚠️ Устарело с версии X"
  - Добавляет новое решение
  - Указывает дату обновления
```

## Структура файлов знаний

### Категоризация

**arch-linux/** - Системные команды и настройки:
- package-management.md
- system-services.md
- kernel-modules.md
- networking.md

**hyprland/** - Специфика Hyprland:
- monitors.md
- keybindings.md
- window-rules.md
- animations.md

**waybar/** - Конфигурация Waybar:
- modules.md
- styling.md
- custom-modules.md

**common-issues/** - Проблемы и решения:
- По одному файлу на проблему
- Индексируются в README.md

**solutions/** - Хронологический архив:
- YYYY-MM-DD-description.md
- Позволяет отследить эволюцию решений

## Обслуживание базы

### Еженедельно
- Просмотр новых solutions/
- Выявление паттернов для категоризации

### Ежемесячно
- Проверка актуальности решений
- Обновление версий в документации
- Чистка дубликатов

### По необходимости
- Реорганизация структуры при росте базы
- Создание новых категорий

---

## Быстрый старт

1. **Создана структура** в `~/.claude/knowledge/`
2. **Настроены агенты** sysadmin и librarian
3. **Начинаем работу**:
   - Решаем задачи как обычно
   - Сохраняем успешные решения
   - База растет органически

**Помни**: Качество > Количество. Лучше 10 проверенных решений, чем 100 непроверенных.

---
Создано: 2025-10-21
Версия: 1.0
